<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FaceChain | Admin SOC</title>
  <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;500;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { font-family: 'Plus Jakarta Sans', sans-serif; }
    body { 
        background-color: #020617; 
        background-image: radial-gradient(at 0% 0%, #0f172a 0px, transparent 50%), 
                          radial-gradient(at 100% 100%, #1e1b4b 0px, transparent 50%);
        color: #f8fafc;
        overflow: hidden; /* FIXED: Added the missing colon here */
    }
    .glass { 
        background: rgba(15, 23, 42, 0.6); 
        backdrop-filter: blur(12px); 
        border: 1px solid rgba(255, 255, 255, 0.08); 
    }
    .sidebar-link:hover { background: rgba(56, 189, 248, 0.1); color: #38bdf8; }
    .active-link { background: rgba(56, 189, 248, 0.15); color: #38bdf8; border-right: 3px solid #38bdf8; }
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }
  </style>
</head>
<body class="h-screen flex">

  <aside class="w-64 border-r border-slate-800 bg-slate-900/50 flex flex-col">
    <div class="p-8">
        <h1 class="text-xl font-extrabold tracking-tighter flex items-center gap-2">
            <div class="w-6 h-6 bg-cyan-500 rounded-lg"></div>
            FACE<span class="text-cyan-400">CHAIN</span>
        </h1>
        <p class="text-[10px] text-slate-500 font-bold mt-1 tracking-widest uppercase">Blockchain SOC</p>
    </div>

    <nav class="flex-1 px-4 space-y-2">
        <a href="index.html" class="sidebar-link flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all group">
            <svg class="w-5 h-5 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
            Home
        </a>
        <a href="upload.html" class="sidebar-link flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all group">
            <svg class="w-5 h-5 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/></svg>
            Register Identity
        </a>
        <a href="authenticate.html" class="sidebar-link flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium transition-all group">
            <svg class="w-5 h-5 opacity-70" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/></svg>
            Auth Check
        </a>
        <div class="active-link flex items-center gap-3 px-4 py-3 rounded-xl text-sm font-medium">
            <svg class="w-5 h-5" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/></svg>
            Admin SOC
        </div>
    </nav>

    <div class="p-4 border-t border-slate-800">
        <button onclick="logout()" class="w-full bg-red-500/10 hover:bg-red-500 text-red-500 hover:text-white p-3 rounded-xl text-xs font-bold transition-all flex items-center justify-center gap-2">
            LOGOUT
        </button>
    </div>
  </aside>

  <main class="flex-1 flex flex-col overflow-hidden">
    <header class="h-16 border-b border-slate-800 flex items-center justify-between px-8 bg-slate-900/40">
        <div id="sync-status" class="flex items-center gap-2 text-[10px] font-bold text-green-500 bg-green-500/10 px-3 py-1 rounded-full">
            <span class="w-1.5 h-1.5 bg-green-500 rounded-full animate-pulse"></span>
            NODE: SYNCED
        </div>
        <div class="text-xs text-slate-500 font-mono">Blockchain Address: <span id="contract-addr" class="text-cyan-700">--</span></div>
    </header>

    <div class="flex-1 overflow-y-auto p-8 space-y-6">
        <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
            <div class="glass p-6 rounded-3xl">
                <p class="text-slate-500 text-[10px] font-black uppercase tracking-widest">Identities</p>
                <h2 id="totalUsers" class="text-3xl font-bold mt-1">0</h2>
            </div>
            <div class="glass p-6 rounded-3xl">
                <p class="text-slate-500 text-[10px] font-black uppercase tracking-widest">Transactions</p>
                <h2 id="totalBlocks" class="text-3xl font-bold mt-1 text-cyan-400">0</h2>
            </div>
            <div class="glass p-6 rounded-3xl">
                <p class="text-slate-500 text-[10px] font-black uppercase tracking-widest">Network Status</p>
                <h2 class="text-3xl font-bold mt-1 text-emerald-500">Active</h2>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-4 gap-6">
            <div class="glass rounded-3xl p-6 flex flex-col h-[500px] lg:col-span-1">
                <input type="text" id="userSearch" placeholder="Search identities..." class="w-full bg-slate-900/50 border border-slate-700 rounded-xl px-4 py-2 text-xs focus:outline-none focus:border-cyan-500 mb-4">
                <div id="userList" class="space-y-2 overflow-y-auto pr-2"></div>
            </div>

            <div class="glass rounded-3xl lg:col-span-3 flex flex-col h-[500px] overflow-hidden">
                <div class="p-6 border-b border-slate-800 flex justify-between items-center">
                    <h3 class="font-bold text-sm uppercase tracking-widest text-slate-400">Immutable Activity Ledger</h3>
                    <button onclick="loadData()" class="text-[10px] font-bold bg-slate-800 px-3 py-1 rounded-lg hover:bg-slate-700 transition-all">REFRESH</button>
                </div>
                <div class="overflow-auto flex-1">
                    <table class="w-full text-left">
                        <thead class="bg-slate-900/80 text-[10px] text-slate-500 uppercase font-black sticky top-0">
                            <tr>
                                <th class="px-6 py-4">Timestamp</th>
                                <th class="px-6 py-4">Activity</th>
                                <th class="px-6 py-4">Identity</th>
                                <th class="px-6 py-4">Status</th>
                                <th class="px-6 py-4 text-right">Hash</th>
                            </tr>
                        </thead>
                        <tbody id="logTable" class="text-[11px] font-mono divide-y divide-slate-800/40"></tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
  </main>

  <script>
    let allUsers = [];

    async function loadData() {
        try {
            const res = await fetch(`http://127.0.0.1:5000/admin/stats?t=${Date.now()}`, { credentials: 'include' });
            if (res.status === 401) { window.location.href = "authenticate.html"; return; }
            
            const data = await res.json();
            allUsers = data.user_list || [];
            
            document.getElementById("totalUsers").innerText = data.total_users;
            document.getElementById("totalBlocks").innerText = data.logs.length;
            
            renderUserList(allUsers);

            const logTable = document.getElementById('logTable');
            logTable.innerHTML = data.logs.map(log => {
                const date = new Date(log.timestamp * 1000).toLocaleTimeString();
                const color = log.status === 'SUCCESS' ? 'text-emerald-400' : 'text-red-400';
                return `
                    <tr class="hover:bg-slate-800/40">
                        <td class="px-6 py-4 text-slate-500">${date}</td>
                        <td class="px-6 py-4 font-bold text-slate-200">${log.action}</td>
                        <td class="px-6 py-4 text-cyan-400">#${log.user_id}</td>
                        <td class="px-6 py-4"><span class="${color} font-black">${log.status}</span></td>
                        <td class="px-6 py-4 text-right text-slate-600">${log.hash_short}</td>
                    </tr>`;
            }).join('');
        } catch (e) { console.error(e); }
    }

    function renderUserList(users) {
        const userList = document.getElementById('userList');
        userList.innerHTML = users.map(u => `
            <div class="p-3 rounded-xl bg-slate-800/30 border border-slate-700/50 flex flex-col">
                <span class="text-xs font-bold text-white">${u.name}</span>
                <span class="text-[9px] text-slate-500 font-mono">ID: ${u.id}</span>
            </div>
        `).join('');
    }

    // Live Search Logic
    document.getElementById('userSearch').addEventListener('input', (e) => {
        const term = e.target.value.toLowerCase();
        const filtered = allUsers.filter(u => u.name.toLowerCase().includes(term) || u.id.toString().includes(term));
        renderUserList(filtered);
    });

    async function logout() {
        await fetch('http://127.0.0.1:5000/logout', { credentials: 'include' });
        window.location.href = "index.html";
    }

    window.onload = loadData;
    setInterval(loadData, 10000);
  </script>
</body>
</html>