<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>FaceChain | Register</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=JetBrains+Mono:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: { extend: { colors: { brand: { 500: '#06b6d4', 600: '#0891b2' } } } }
        }
    </script>
    <style>
        body { background-color: #020617; color: #e2e8f0; font-family: 'Inter', sans-serif; }
        .glass { background: rgba(30, 41, 59, 0.4); backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.05); }
        video { transform: scaleX(-1); border-radius: 12px; border: 2px solid #1e293b; width: 100%; box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.5); }
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <nav class="border-b border-slate-800 bg-slate-950/80 backdrop-blur sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-6 h-16 flex items-center justify-between">
            <a href="index.html" class="flex items-center gap-2 font-bold text-white text-xl">
                <div class="w-6 h-6 bg-brand-500 rounded flex items-center justify-center text-black text-xs">R</div> Register
            </a>
            <div class="text-sm text-slate-400">
                <a href="index.html" class="hover:text-white mr-4">Home</a>
                <a href="authenticate.html" class="hover:text-white">Authenticate</a>
            </div>
        </div>
    </nav>

    <main class="flex-1 max-w-5xl mx-auto w-full p-6 grid md:grid-cols-2 gap-8 items-start mt-8">
        
        <div class="glass p-8 rounded-2xl">
            <div class="mb-8">
                <h1 class="text-3xl font-bold text-white mb-2">New Identity</h1>
                <p class="text-slate-400 text-sm">Create a permanent record on the blockchain.</p>
            </div>

            <div class="space-y-6">
                <div>
                    <label class="block text-xs font-mono text-brand-500 mb-2 uppercase tracking-widest">Step 1: Assign ID</label>
                    <input type="text" id="userIdInput" placeholder="Enter ID (e.g., 102)" class="w-full bg-slate-900 border border-slate-700 rounded-lg p-3 text-white focus:outline-none focus:border-brand-500 transition-colors placeholder-slate-600 font-mono">
                    <p class="text-xs text-slate-500 mt-2">* Use ID '1' to register as Admin.</p>
                </div>

                <div class="border-t border-slate-800 pt-6">
                    <label class="block text-xs font-mono text-brand-500 mb-2 uppercase tracking-widest">Step 2: Source</label>
                    
                    <div class="relative group cursor-pointer mb-4">
                        <input type="file" id="fileInput" accept="image/*" class="absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10">
                        <div class="border-2 border-dashed border-slate-700 group-hover:border-brand-500 rounded-lg p-6 text-center transition-colors">
                            <span class="text-2xl block mb-2">üìÅ</span>
                            <span class="text-sm text-slate-400 group-hover:text-brand-500">Drag file or click to upload</span>
                        </div>
                    </div>
                    <button id="uploadBtn" class="w-full bg-slate-800 hover:bg-slate-700 text-white py-3 rounded-lg font-medium transition-colors border border-slate-700">Use Uploaded Image</button>
                </div>
            </div>
            
            <div id="message" class="mt-6 p-4 rounded-lg bg-slate-900/50 border border-slate-800 min-h-[60px] flex items-center justify-center text-sm font-mono text-slate-500">
                Ready to process...
            </div>
        </div>

        <div class="flex flex-col gap-4">
            <div class="relative rounded-2xl overflow-hidden bg-black border border-slate-800 aspect-video flex items-center justify-center group">
                <video id="video" autoplay muted playsinline></video>
                <div class="absolute inset-0 pointer-events-none border border-brand-500/20 rounded-xl"></div>
                <div class="absolute bottom-4 left-1/2 -translate-x-1/2 flex gap-2">
                    <button id="startBtn" class="bg-slate-800/80 backdrop-blur hover:bg-white hover:text-black text-white px-4 py-2 rounded-full text-xs font-bold transition-all border border-slate-600">ON</button>
                    <button id="stopBtn" class="bg-slate-800/80 backdrop-blur hover:bg-red-500 text-white px-4 py-2 rounded-full text-xs font-bold transition-all border border-slate-600">OFF</button>
                </div>
            </div>

            <button id="captureBtn" class="w-full bg-brand-600 hover:bg-brand-500 text-white py-4 rounded-xl font-bold shadow-lg shadow-brand-900/20 transition-all flex items-center justify-center gap-2">
                <div class="w-2 h-2 rounded-full bg-white animate-pulse"></div> Capture & Register Live
            </button>
            
            <p class="text-center text-xs text-slate-500">Ensure face is well-lit and unobstructed.</p>
        </div>
    </main>

    <script>
        // Keep logic exactly the same, just updated selectors
        const video = document.getElementById('video');
        const startBtn = document.getElementById('startBtn');
        const stopBtn = document.getElementById('stopBtn');
        const captureBtn = document.getElementById('captureBtn');
        const fileInput = document.getElementById('fileInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const message = document.getElementById('message');
        const userIdInput = document.getElementById('userIdInput');
        let stream = null;

        startBtn.onclick = async () => {
            try { stream = await navigator.mediaDevices.getUserMedia({ video:true }); video.srcObject = stream; } 
            catch(err) { alert("Camera Error: " + err); }
        };
        stopBtn.onclick = () => { if(stream){ stream.getTracks().forEach(t => t.stop()); stream = null; video.srcObject = null; } };

        async function sendData(imageData, userId) {
            message.innerHTML = '<span class="animate-pulse text-brand-500">‚è≥ Encryption & Hashing in progress...</span>';
            try {
                const res = await fetch('http://127.0.0.1:5000/register', {
                    method: 'POST', mode: 'cors', headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ image: imageData, user_id: userId }), credentials: 'include'
                });
                const contentType = res.headers.get("content-type");
                if (contentType && contentType.indexOf("application/json") !== -1) {
                    const data = await res.json();
                    message.innerHTML = res.ok 
                        ? `<span class="text-green-400">‚úÖ Registered: ${data.message}</span>`
                        : `<span class="text-red-400">‚ùå Error: ${data.error}</span>`;
                } else { message.innerHTML = `<span class="text-red-400">‚ùå Server Error (500)</span>`; }
            } catch(err){ message.innerHTML = `<span class="text-red-400">‚ùå Connection Failure</span>`; }
        }

        captureBtn.onclick = async () => {
            if(!userIdInput.value) return alert("Enter ID first");
            if(!stream) return alert("Start Camera");
            const c = document.createElement('canvas'); c.width = video.videoWidth; c.height = video.videoHeight;
            c.getContext('2d').drawImage(video, 0, 0);
            await sendData(c.toDataURL('image/png'), userIdInput.value);
        };

        uploadBtn.onclick = async () => {
            if(!userIdInput.value) return alert("Enter ID first");
            if(!fileInput.files[0]) return alert("Select file");
            const r = new FileReader();
            r.onloadend = async () => await sendData(r.result, userIdInput.value);
            r.readAsDataURL(fileInput.files[0]);
        };
    </script>
</body>
</html>